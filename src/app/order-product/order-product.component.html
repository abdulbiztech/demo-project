<div class="order-container">
  <form (submit)="onSubmit()" [formGroup]="orderForm">
    <div class="header">
      <label class="user-name">User Name: {{ userName }}</label>
      <button type="button" class="logout-btn" (click)="onLogout()">
        Logout
      </button>
    </div>
    <div class="form-group">
      <label for="name">Name:</label>
      <input type="text" id="name" formControlName="name" />
      <div
        class="error"
        *ngIf="
          orderForm.get('name')?.invalid &&
          (orderForm.get('name')?.dirty || orderForm.get('name')?.touched)
        "
      >
        <div *ngIf="orderForm.get('name')?.errors?.['required']">
          Name is required.
        </div>
        <div *ngIf="orderForm.get('name')?.errors?.['minlength']">
          Name must be at least 5 characters long.
        </div>
        <div *ngIf="orderForm.get('name')?.errors?.['maxlength']">
          Name cannot be more than 40 characters long.
        </div>
      </div>
    </div>
    <div class="form-group">
      <label for="date">Date:</label>
      <input type="date" id="date" formControlName="date" />
      <div
        class="error"
        *ngIf="
          orderForm.get('date')?.invalid &&
          (orderForm.get('date')?.dirty || orderForm.get('date')?.touched)
        "
      >
        <div *ngIf="orderForm.get('date')?.errors?.['required']">
          Date is required.
        </div>
      </div>
    </div>
    <div class="form-group">
      <label for="mobile">Mobile:</label>
      <input id="mobile" formControlName="mobile" />
      <div
        class="error"
        *ngIf="
          orderForm.get('mobile')?.invalid &&
          (orderForm.get('mobile')?.dirty || orderForm.get('mobile')?.touched)
        "
      >
        <div *ngIf="orderForm.get('mobile')?.errors?.['required']">
          Mobile is required.
        </div>
        <div *ngIf="orderForm.get('mobile')?.errors?.['pattern']">
          Invalid mobile number.
        </div>
      </div>
    </div>
    <div class="form-group">
      <label for="email">Email Id:</label>
      <input id="email" formControlName="email" type="email" />
      <div
        class="error"
        *ngIf="
          orderForm.get('email')?.invalid &&
          (orderForm.get('email')?.dirty || orderForm.get('email')?.touched)
        "
      >
        <div *ngIf="orderForm.get('email')?.errors?.['required']">
          Email is required.
        </div>
        <div *ngIf="orderForm.get('email')?.errors?.['email']">
          Invalid email address.
        </div>
      </div>
    </div>
    <div formArrayName="products">
      <div
        *ngFor="let product of productFormArray.controls; let i = index"
        [formGroupName]="i"
        class="product-group"
      >
        <label for="id-{{ i }}">Product ID:</label>
        <input
          id="id-{{ i }}"
          formControlName="id"
          (change)="onProductIdChange(i)"
        />
        <div
          class="error"
          *ngIf="
            product.get('id')?.invalid &&
            (product.get('id')?.dirty || product.get('id')?.touched)
          "
        >
          <div *ngIf="product.get('id')?.errors?.['required']">
            Product ID is required.
          </div>
        </div>

        <label for="code-{{ i }}">Product Code:</label>
        <input id="code-{{ i }}" formControlName="code" [disabled]="true" />

        <label for="rate-{{ i }}">Rate:</label>
        <input id="rate-{{ i }}" formControlName="rate" [disabled]="true" />

        <label for="quantity-{{ i }}">Quantity:</label>
        <input
          id="quantity-{{ i }}"
          formControlName="quantity"
          type="number"
          (change)="calculateProductValue(i)"
        />
        <div
          class="error"
          *ngIf="
            product.get('quantity')?.invalid &&
            (product.get('quantity')?.dirty || product.get('quantity')?.touched)
          "
        >
          <div *ngIf="product.get('quantity')?.errors?.['required']">
            Quantity is required.
          </div>
          <div *ngIf="product.get('quantity')?.errors?.['min']">
            Quantity must be at least 1.
          </div>
        </div>

        <label for="value-{{ i }}">Value:</label>
        <input id="value-{{ i }}" formControlName="value" [disabled]="true" />

        <button type="button" (click)="removeProduct(i)">Remove</button>
      </div>
    </div>
    <div class="form-group">
      <button type="button" (click)="addProduct()">Add Product</button>
    </div>
    <div class="form-group">
      <label for="total-quantity">Total Quantity:</label>
      <input id="total-quantity" [value]="totalQuantity" disabled />
    </div>
    <div class="form-group">
      <label for="total-value">Total Value:</label>
      <input id="total-value" [value]="totalValue" disabled />
    </div>
    <div class="form-group">
      <label for="discount">Discount:</label>
      <input
        id="discount"
        formControlName="discount"
        type="number"
        (change)="calculateTotals()"
      />
    </div>
    <div class="form-group">
      <label for="invoice-amount">Invoice Amount:</label>
      <input id="invoice-amount" [value]="invoiceAmount" disabled />
    </div>
    <div class="form-group">
      <button type="submit">Save</button>
      <button type="button" (click)="onCancel()">Reset</button>
    </div>
  </form>
</div>
